{"ast":null,"code":"import _objectSpread from \"C:/Users/Ignacio/OneDrive - UNIVERSIDAD ANDRES BELLO/Desktop/Ingenieria de software/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nvar _jsxFileName = \"C:\\\\Users\\\\Ignacio\\\\OneDrive - UNIVERSIDAD ANDRES BELLO\\\\Desktop\\\\Ingenieria de software\\\\frontend\\\\src\\\\ProductCatalog.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ProductCatalog(_ref) {\n  _s();\n  let {\n    api,\n    token\n  } = _ref;\n  const [products, setProducts] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [filtros, setFiltros] = useState([]);\n  const nav = useNavigate();\n\n  // 1) traer categor√≠as\n  useEffect(() => {\n    fetch(\"\".concat(api, \"/categories\")).then(r => r.json()).then(setCategories);\n  }, [api]);\n\n  // 2) traer productos cada vez que cambian filtros\n  useEffect(() => {\n    const qs = filtros.length ? \"?categories=\".concat(filtros.join(',')) : '';\n    fetch(\"\".concat(api, \"/products\").concat(qs)).then(r => r.json()).then(setProducts);\n  }, [api, filtros]);\n  const toggleFiltro = cat => {\n    setFiltros(f => f.includes(cat) ? f.filter(x => x !== cat) : [...f, cat]);\n  };\n  const addToFav = async id => {\n    if (!token) return alert('Haz login primero');\n    await fetch(\"\".concat(api, \"/favorites\"), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \"Bearer \".concat(token)\n      },\n      body: JSON.stringify({\n        productId: id\n      })\n    });\n    // podr√≠as indicar con un mensaje o cambiar icono en UI\n  };\n  const handlePurchase = async productId => {\n    if (!token) return alert('Haz login primero');\n    const res = await fetch(\"\".concat(api, \"/purchase\"), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \"Bearer \".concat(token)\n      },\n      body: JSON.stringify({\n        productId,\n        quantity: 1\n      })\n    });\n    const data = await res.json();\n    if (res.ok) {\n      // 21) actualizar stock en frontend\n      setProducts(ps => ps.map(p => p.id === productId ? _objectSpread(_objectSpread({}, p), {}, {\n        stock: p.stock - 1\n      }) : p));\n      // 33) navegar a PDF de boleta\n      nav(\"/receipt/\".concat(data.orderId));\n    } else {\n      alert(data.message || 'Error al comprar');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Cat\\xE1logo\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"filtros\",\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Filtrar por categor\\xEDas:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), categories.map(c => /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          checked: filtros.includes(c),\n          onChange: () => toggleFiltro(c)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 13\n        }, this), c]\n      }, c, true, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid\",\n      children: products.map(p => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card producto\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: p.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Stock: \", p.stock]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => handlePurchase(p.id),\n          children: \"Comprar 1\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this), ' ', /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => addToFav(p.id),\n          children: p.isFavorite ? 'üíñ' : 'ü§ç'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 13\n        }, this)]\n      }, p.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n}\n_s(ProductCatalog, \"i6FuivQ6HHTkIZfZUvOiSxTc4gg=\", false, function () {\n  return [useNavigate];\n});\n_c = ProductCatalog;\nvar _c;\n$RefreshReg$(_c, \"ProductCatalog\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","jsxDEV","_jsxDEV","ProductCatalog","_ref","_s","api","token","products","setProducts","categories","setCategories","filtros","setFiltros","nav","fetch","concat","then","r","json","qs","length","join","toggleFiltro","cat","f","includes","filter","x","addToFav","id","alert","method","headers","body","JSON","stringify","productId","handlePurchase","res","quantity","data","ok","ps","map","p","_objectSpread","stock","orderId","message","children","fileName","_jsxFileName","lineNumber","columnNumber","className","c","type","checked","onChange","name","onClick","isFavorite","_c","$RefreshReg$"],"sources":["C:/Users/Ignacio/OneDrive - UNIVERSIDAD ANDRES BELLO/Desktop/Ingenieria de software/frontend/src/ProductCatalog.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport default function ProductCatalog({ api, token }) {\r\n  const [products, setProducts]     = useState([]);\r\n  const [categories, setCategories] = useState([]);\r\n  const [filtros, setFiltros]       = useState([]);\r\n  const nav = useNavigate();\r\n\r\n  // 1) traer categor√≠as\r\n  useEffect(() => {\r\n    fetch(`${api}/categories`)\r\n      .then(r=>r.json())\r\n      .then(setCategories);\r\n  },[api]);\r\n\r\n  // 2) traer productos cada vez que cambian filtros\r\n  useEffect(() => {\r\n    const qs = filtros.length\r\n      ? `?categories=${filtros.join(',')}`\r\n      : '';\r\n    fetch(`${api}/products${qs}`)\r\n      .then(r=>r.json())\r\n      .then(setProducts);\r\n  }, [api, filtros]);\r\n\r\n  const toggleFiltro = cat => {\r\n    setFiltros(f =>\r\n      f.includes(cat)\r\n        ? f.filter(x=>x!==cat)\r\n        : [...f, cat]\r\n    );\r\n  };\r\n\r\n  const addToFav = async id => {\r\n    if (!token) return alert('Haz login primero');\r\n    await fetch(`${api}/favorites`, {\r\n      method:'POST',\r\n      headers:{\r\n        'Content-Type':'application/json',\r\n        'Authorization': `Bearer ${token}`\r\n      },\r\n      body: JSON.stringify({ productId:id })\r\n    });\r\n    // podr√≠as indicar con un mensaje o cambiar icono en UI\r\n  };\r\n\r\n  const handlePurchase = async (productId) => {\r\n    if (!token) return alert('Haz login primero');\r\n    const res = await fetch(`${api}/purchase`, {\r\n      method:'POST',\r\n      headers:{\r\n        'Content-Type':'application/json',\r\n        'Authorization': `Bearer ${token}`\r\n      },\r\n      body: JSON.stringify({ productId, quantity: 1 })\r\n    });\r\n    const data = await res.json();\r\n    if (res.ok) {\r\n      // 21) actualizar stock en frontend\r\n      setProducts(ps =>\r\n        ps.map(p =>\r\n          p.id === productId\r\n            ? { ...p, stock: p.stock - 1 }\r\n            : p\r\n        )\r\n      );\r\n      // 33) navegar a PDF de boleta\r\n      nav(`/receipt/${data.orderId}`);\r\n    } else {\r\n      alert(data.message || 'Error al comprar');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2>Cat√°logo</h2>\r\n\r\n      <div className=\"filtros\">\r\n        <strong>Filtrar por categor√≠as:</strong>\r\n        {categories.map(c=>(\r\n          <label key={c}>\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={filtros.includes(c)}\r\n              onChange={()=>toggleFiltro(c)}\r\n            />\r\n            {c}\r\n          </label>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"grid\">\r\n        {products.map(p=>(\r\n          <div className=\"card producto\" key={p.id}>\r\n            <h3>{p.name}</h3>\r\n            <p>Stock: {p.stock}</p>\r\n            <button onClick={()=>handlePurchase(p.id)}>\r\n              Comprar 1\r\n            </button>{' '}\r\n            <button onClick={()=>addToFav(p.id)}>\r\n              {p.isFavorite ? 'üíñ' : 'ü§ç'}\r\n            </button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}